<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Simple Formatting</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon/recipe_color.png">
    <link rel="apple-touch-icon" href="favicon/recipe_color.png">
</head>
<body>
    <h3>Recipe Simple Formatting</h3>
    <p>
        This tool removes all formatting from recipes, leaving only plain text, used to help with recipe uploads to certain websites.
    </p>

    <!-- Recipe input form -->
    <form>
        <label for="recipe-input">Enter your recipe:</label><br>
        <textarea id="recipe-input" name="recipe" rows="10" cols="50"></textarea><br>
        <input type="submit" value="Remove Formatting">
    </form>

    <h3>Cleaned Text</h3>
    <textarea id="cleaned-output" name="cleaned-recipe" rows="10" cols="50" readonly></textarea>
    <br>
    <button id="copy-button">Copy to Clipboard</button>
    
    <!-- Success popup notification -->
    <div id="success-popup" class="popup">
        <div class="popup-content">
            <span class="popup-text">âœ… Formatting removed successfully!</span>
        </div>
    </div>
    
    <!-- Include the cleanText.js script -->
    <script src="js/cleanText.js"></script>
    
    <!-- Include the rateLimiter.js script -->
    <script src="js/rateLimiter.js"></script>
    
    <!-- Include the errorLogger.js script -->
    <script src="js/errorLogger.js"></script>
    
    <script>
        // Handle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const recipeInput = document.getElementById('recipe-input');
            const cleanedOutput = document.getElementById('cleaned-output');
            const copyButton = document.getElementById('copy-button');

            form.addEventListener('submit', function(e) {
                e.preventDefault(); // Prevent form from actually submitting
                
                try {
                    // Check rate limit first
                    if (isRateLimited()) {
                        showRateLimitMessage();
                        return;
                    }
                    
                    const rawText = recipeInput.value;
                    if (rawText.trim()) {
                        // Use the function from cleanText.js
                        const cleanedText = cleanRecipeText(rawText);
                        cleanedOutput.value = cleanedText;
                        
                        // Show success popup
                        showSuccessPopup();
                    } else {
                        alert('Please enter some recipe text first!');
                    }
                } catch (error) {
                    errorLogger.logCustomError('Form submission failed', {
                        error: error.message,
                        stack: error.stack
                    });
                    alert('An error occurred. Please try again.');
                }
            });

            // Handle copy to clipboard
            copyButton.addEventListener('click', function() {
                try {
                    if (cleanedOutput.value) {
                        cleanedOutput.select();
                        document.execCommand('copy');
                        
                        // Provide feedback
                        const originalText = copyButton.textContent;
                        copyButton.textContent = 'Copied!';
                        setTimeout(() => {
                            copyButton.textContent = originalText;
                        }, 2000);
                    } else {
                        alert('No cleaned text to copy!');
                    }
                } catch (error) {
                    errorLogger.logCustomError('Copy to clipboard failed', {
                        error: error.message,
                        stack: error.stack
                    });
                    alert('Failed to copy text. Please select and copy manually.');
                }
            });
            
            // Function to show success popup
            function showSuccessPopup() {
                const popup = document.getElementById('success-popup');
                popup.classList.add('show');
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 3000);
            }
        });
    </script>
    <footer>
        <a href="https://www.flaticon.com/free-icons/recipe" title="recipe icons">Recipe icons created by photo3idea_studio - Flaticon</a>
    </footer>
    
</body>

</html>