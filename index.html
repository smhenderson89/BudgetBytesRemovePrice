<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Simple Formatting</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/recipe_color.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/recipe_color.png">
    <link rel="apple-touch-icon" href="favicon/recipe_color.png">
    <link rel="shortcut icon" href="favicon/recipe_color.png">
</head>
<body>
    <h3>Recipe Simple Formatting</h3>
    <p>
        This tool removes all formatting from recipes, leaving only plain text, used to help with recipe uploads to certain websites.
    </p>

    <!-- Recipe input form, triggers index.js when clicked  -->
    <form action="" method="">
        <label for="recipe-input">Enter your recipe:</label><br>
        <textarea id="recipe-input" name="recipe" rows="10" cols="50"></textarea><br>
        <input type="submit" value="Remove Formatting">
    </form>

    <h3>Cleaned Text</h3>
    <textarea id="cleaned-output" name="cleaned-recipe" rows="10" cols="50" readonly></textarea>
    <br>
    <button id="copy-button">Copy to Clipboard</button>
    
    <!-- Error Logging Admin Panel (Hidden by default) -->
    <div id="error-admin" style="display: none; margin-top: 2rem; padding: 1rem; border: 2px solid #dc3545; border-radius: 8px; background-color: #f8f9fa;">
        <h4 style="color: #dc3545; text-align: center;">üõ†Ô∏è Error Logging Admin Panel</h4>
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <button onclick="showErrorSummary()" style="background-color: #17a2b8;">View Summary</button>
            <button onclick="downloadErrorLog()" style="background-color: #28a745;">Download Errors</button>
            <button onclick="clearErrorLog()" style="background-color: #dc3545;">Clear Errors</button>
            <button onclick="testError()" style="background-color: #ffc107; color: #000;">Test Error</button>
        </div>
        <div id="error-summary" style="margin-top: 1rem; padding: 1rem; background-color: #e9ecef; border-radius: 4px; font-family: monospace; white-space: pre-wrap;"></div>
    </div>
    
    <!-- Success popup notification -->
    <div id="success-popup" class="popup">
        <div class="popup-content">
            <span class="popup-text">‚úÖ Formatting removed successfully!</span>
        </div>
    </div>
    
    <!-- Include the cleanText.js script -->
    <script src="cleanText.js"></script>
    
    <!-- Include the rateLimiter.js script -->
    <script src="rateLimiter.js"></script>
    
    <!-- Include the errorLogger.js script -->
    <script src="errorLogger.js"></script>
    
    <script>
        // Handle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const recipeInput = document.getElementById('recipe-input');
            const cleanedOutput = document.getElementById('cleaned-output');
            const copyButton = document.getElementById('copy-button');

            form.addEventListener('submit', function(e) {
                e.preventDefault(); // Prevent form from actually submitting
                
                try {
                    // Check rate limit first
                    if (isRateLimited()) {
                        showRateLimitMessage();
                        return;
                    }
                    
                    const rawText = recipeInput.value;
                    if (rawText.trim()) {
                        // Use the function from cleanText.js
                        const cleanedText = cleanRecipeText(rawText);
                        cleanedOutput.value = cleanedText;
                        
                        // Show success popup
                        showSuccessPopup();
                    } else {
                        alert('Please enter some recipe text first!');
                    }
                } catch (error) {
                    errorLogger.logCustomError('Form submission failed', {
                        error: error.message,
                        stack: error.stack
                    });
                    alert('An error occurred. Please try again.');
                }
            });

            // Handle copy to clipboard
            copyButton.addEventListener('click', function() {
                try {
                    if (cleanedOutput.value) {
                        cleanedOutput.select();
                        document.execCommand('copy');
                        
                        // Provide feedback
                        const originalText = copyButton.textContent;
                        copyButton.textContent = 'Copied!';
                        setTimeout(() => {
                            copyButton.textContent = originalText;
                        }, 2000);
                    } else {
                        alert('No cleaned text to copy!');
                    }
                } catch (error) {
                    errorLogger.logCustomError('Copy to clipboard failed', {
                        error: error.message,
                        stack: error.stack
                    });
                    alert('Failed to copy text. Please select and copy manually.');
                }
            });
            
            // Show admin panel with keyboard shortcut (Ctrl+Shift+E)
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'E') {
                    const adminPanel = document.getElementById('error-admin');
                    adminPanel.style.display = adminPanel.style.display === 'none' ? 'block' : 'none';
                    if (adminPanel.style.display === 'block') {
                        showErrorSummary();
                    }
                }
            });
            
            // Function to show success popup
            function showSuccessPopup() {
                const popup = document.getElementById('success-popup');
                popup.classList.add('show');
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 3000);
            }
        });

        // Error Admin Panel Functions
        function showErrorSummary() {
            const summary = getErrorSummary();
            const summaryDiv = document.getElementById('error-summary');
            if (typeof summary === 'object') {
                summaryDiv.textContent = JSON.stringify(summary, null, 2);
            } else {
                summaryDiv.textContent = summary;
            }
        }

        function testError() {
            // Intentionally trigger an error for testing
            errorLogger.logCustomError('Test error generated by admin', {
                testData: 'This is a test error',
                timestamp: new Date().toISOString()
            });
            alert('Test error logged! Check the summary to see it.');
            showErrorSummary();
        }
    </script>
    <footer>
        <a href="https://www.flaticon.com/free-icons/recipe" title="recipe icons">Recipe icons created by photo3idea_studio - Flaticon</a>
    </footer>
    
</body>

</html>